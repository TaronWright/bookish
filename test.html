<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flexbox Image Gallery with Preload</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 40px auto;
  }
  .gallery {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .main-image {
    width: 100%;
    height: 350px;
    object-fit: cover;
  }
  .thumbs-container {
    display: flex;
    align-items: center;
  }
  .arrow {
    cursor: pointer;
    font-size: 28px;
    user-select: none;
    padding: 5px 10px;
    color: #888;
    font-weight: 600;
    transition: color 0.3s;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  .arrow:hover {
    color: #555;
  }
  .thumbs {
    display: flex;
    overflow: hidden;
    gap: 10px;
    flex-grow: 1;
  }
  .thumbs img {
    width: 80px;
    height: 60px;
    object-fit: cover;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s;
    flex-shrink: 0;
  }
  .thumbs img.selected {
    border-color: #007BFF;
  }
</style>
</head>
<body>

<div class="gallery">
  <img id="mainImage" class="main-image" src="https://picsum.photos/id/1018/600/350" alt="Main Image" />

  <div class="thumbs-container">
    <div id="leftArrow" class="arrow">&#8592;</div>
    <div class="thumbs" id="thumbs"></div>
    <div id="rightArrow" class="arrow">&#8594;</div>
  </div>
</div>

<script>
  const images = [
    "https://picsum.photos/id/1018/600/350",
    "https://picsum.photos/id/1025/600/350",
    "https://picsum.photos/id/1035/600/350",
    "https://picsum.photos/id/1041/600/350",
    "https://picsum.photos/id/1050/600/350",
    "https://picsum.photos/id/1060/600/350",
    "https://picsum.photos/id/1074/600/350",
  ];

  const thumbsContainer = document.getElementById('thumbs');
  const mainImage = document.getElementById('mainImage');
  const leftArrow = document.getElementById('leftArrow');
  const rightArrow = document.getElementById('rightArrow');

  let currentIndex = 0;
  let startVisibleIndex = 0; // for scrolling thumbnails
  const visibleThumbsCount = 5; // how many thumbnails visible at once

  // Preload images function
  function preloadImages(urls, callback) {
    let loadedCount = 0;
    const total = urls.length;
    urls.forEach(url => {
      const img = new Image();
      img.src = url;
      img.onload = () => {
        loadedCount++;
        if (loadedCount === total) callback();
      };
      img.onerror = () => {
        // Even if error, count as loaded so gallery still initializes
        loadedCount++;
        if (loadedCount === total) callback();
      };
    });
  }

  function render() {
    thumbsContainer.innerHTML = '';
    for (let i = startVisibleIndex; i < Math.min(startVisibleIndex + visibleThumbsCount, images.length); i++) {
      const thumb = document.createElement('img');
      thumb.src = images[i];
      thumb.alt = `Thumbnail ${i + 1}`;
      thumb.classList.toggle('selected', i === currentIndex);
      thumb.addEventListener('click', () => {
        currentIndex = i;
        mainImage.src = images[i];
        render();
      });
      thumbsContainer.appendChild(thumb);
    }

    leftArrow.style.visibility = startVisibleIndex > 0 ? 'visible' : 'hidden';
    rightArrow.style.visibility = startVisibleIndex + visibleThumbsCount < images.length ? 'visible' : 'hidden';
  }

  leftArrow.addEventListener('click', () => {
    if (startVisibleIndex > 0) {
      startVisibleIndex--;
      render();
    }
  });

  rightArrow.addEventListener('click', () => {
    if (startVisibleIndex + visibleThumbsCount < images.length) {
      startVisibleIndex++;
      render();
    }
  });

  // Preload all thumbnails, then initialize gallery
  preloadImages(images, () => {
    mainImage.src = images[currentIndex];
    render();
  });
</script>

</body>
</html>
